// aviator@0.6.6 downloaded from https://ga.jspm.io/npm:aviator@0.6.6/index.js

import t from"util";import e from"events";var r={};var i=function bind(t,e){return function(){t.apply(e,Array.prototype.slice.call(arguments))}};var n=function each(t,e,r){r=r||this;for(var i=0,n=t.length;i<n;i++)e.call(r,t[i],i)};var a=function compact(t){return t.filter((function(t){return!!t}))};var o=function map(t,e){return t.map(e)};var s=function merge(){var t={},e=Array.prototype.slice.call(arguments,0);n(e,(function(e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}));return t};var u=function addEvent(t,e,r,n){t.addEventListener(e,i(r,n),false)};var h=function isArray(t){return Array.isArray(t)};var c=function isFunc(t){return"function"===typeof t};var m=function isPlainObject(t){return!!t&&t.constructor===Object};var f=function isString(t){return"string"===typeof t};r={bind:i,each:n,compact:a,map:o,merge:s,addEvent:u,isArray:h,isFunc:c,isPlainObject:m,isString:f};var l=r;var d={};var p=t;var v=l;var g=v.compact;var R=v.map;var _=e.EventEmitter;var y=function ActionEmitter(){this.getExitMessage=function(){return g(R(this.listeners("exit"),(function(t){return t()}))).join(", ")||void 0};return this};p.inherits(y,_);d=y;var P=d;var w={};var F=l,S=F.each,x=F.merge,I=F.isArray;var U=function Request(t){this.namedParams={};this.queryParams={};this.params={};this.uri=t.uri;this.queryString=t.queryString;this.matchedRoute=t.matchedRoute;this._extractNamedParamsFromURI();this._extractQueryParamsFromQueryString();this._mergeParams()};U.prototype={_extractNamedParamsFromURI:function _extractNamedParamsFromURI(){var t=this.uri.split("/"),e=this.matchedRoute.split("/"),r={};S(e,(function(e,i){var n;if(0===e.indexOf(":")){n=e.replace(":","");r[n]=decodeURIComponent(t[i])}}));this.namedParams=r},_extractQueryParamsFromQueryString:function _extractQueryParamsFromQueryString(){var t;if(this.queryString){t=this.queryString.replace("?","").split("&");S(t,(function(t){var e=decodeURIComponent(t.split("=")[0]),r=decodeURIComponent(t.split("=")[1]);-1!==t.indexOf("=")&&this._applyQueryParam(e,r)}),this)}},_applyQueryParam:function _applyQueryParam(t,e){if(-1!==t.indexOf("[]")){t=t.replace("[]","");I(this.queryParams[t])?this.queryParams[t].push(e):this.queryParams[t]=[e]}else this.queryParams[t]=e},_mergeParams:function _mergeParams(){this.params=x(this.namedParams,this.queryParams)}};w=U;var C=w;var E={};var O=l,q=O.merge,b=O.isFunc,A=O.isString,Q=O.isPlainObject;var k=function Route(t,e){this.uri=e;this.matchedRoute="";this.targets=[];this.actions=[];this.exits=[];this.options={};this.notFound=null;this.fullMatch=false;this.matchOrNotFound(t);this.uri=e};k.prototype={matchOrNotFound:function matchOrNotFound(t){this.match(t);!this.fullMatch&&this.notFound&&this.actions.push(this.notFound)},match:function match(t){var e,r,i;t.target&&this.targets.push(t.target);this.targets.length&&(i=this.targets[this.targets.length-1]);t.notFound&&i[t.notFound]?this.notFound={target:i,method:t.notFound}:b(t.notFound)&&(this.notFound=this.anonymousAction(t.notFound));for(var n in t)if(t.hasOwnProperty(n)){r={target:i,method:null};e=t[n];if(this.isFragment(n)&&this.isFragmentInURI(n)){this.updateMatchedRoute(n);this.removeFragmentFromURI(n);if(this.isActionDescriptor(e)){if(!this.isNamedParam(n)||!r.method){if(A(e))r.method=e;else if(b(e))r=this.anonymousAction(e);else{r.method=e.method;e.exit&&this.exits.unshift({method:e.exit,target:t.target});e.options&&this.mergeOptions(e.options)}this.actions.push(r);"/*"!==n&&(this.fullMatch=true)}}else e.hasOwnProperty("options")&&this.mergeOptions(e.options);Q(e)&&this.match(e)}}},mergeOptions:function mergeOptions(t){this.options=q(this.options,t)},updateMatchedRoute:function updateMatchedRoute(t){"/"!==t&&"/*"!==t&&(this.matchedRoute+=t)},removeFragmentFromURI:function removeFragmentFromURI(t){var e=this.uri,r,i;if("/"!==t&&"/*"!==t)if(this.includesNamedParam(t)){r=e.split("/"),i=t.split("/");i.forEach((function(t,i){0===t.indexOf(":")?e=e.replace("/"+r[i],""):t&&(e=e.replace("/"+t,""))}))}else e=e.replace(t,"");this.uri=e},isFragmentInURI:function isFragmentInURI(t){var e=this.uri,r,i;if("/"===e||""===e)return"/"===t||"/*"===t;if("/"===t)return false;if("/*"===t)return true;if(this.includesNamedParam(t)){r=e.split("/"),i=t.split("/");return 2===i.length||i.map((function(t,e){return 0===t.indexOf(":")||-1!==r[e].indexOf(t)})).reduce((function(t,e){return t&&e}))}return 0===e.indexOf(t)},includesNamedParam:function includesNamedParam(t){return-1!==t.indexOf("/:")},isFragment:function isFragment(t){return 0===t.indexOf("/")},isActionDescriptor:function isActionDescriptor(t){return A(t)||b(t)||Q(t)&&t.method},isNamedParam:function isNamedParam(t){return 0===t.indexOf("/:")},anonymousAction:function anonymousAction(t){return{target:{lambda:t},method:"lambda"}}};E=k;var N=E;var M={};var j=P;var D=l,z=C,B=N;var T=D.each,K=D.map,L=D.compact,V=D.addEvent,G=D.isArray;var H=function Navigator(){this._routes=null;this._exits=[];this._silent=false;this._dispatchingStarted=false;this._emitters=[]};H.prototype={setup:function setup(t){t=t||{};for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this._attachEvents()},setRoutes:function setRoutes(t){this._routes=t},createRouteForURI:function createRouteForURI(t){return new B(this._routes,t)},createRequest:function createRequest(t,e,r){this._request=new z({uri:t,queryString:e,matchedRoute:r});return this._request},getCurrentRequest:function getCurrentRequest(){return this._request},getCurrentPathname:function getCurrentPathname(){return this.pushStateEnabled?this._removeURIRoot(location.pathname):location.hash.replace("#","").split("?")[0]},getCurrentURI:function getCurrentURI(){return this.pushStateEnabled?this._removeURIRoot(location.pathname)+location.search:location.hash.replace("#","")},getQueryString:function getQueryString(){var t,e;if(this.pushStateEnabled)return location.search||null;e=this.getCurrentURI().split("?")[1];return e?"?"+e:null},dispatch:function dispatch(){var t=this.getCurrentPathname(),e=this.createRouteForURI(t),r=this.getQueryString(),i=this.createRequest(t,r,e.matchedRoute);this._emitters=[];this._invokeExits(i);this._actions=e.actions;this._silent||this._invokeActions(i,e.options);this._exits=e.exits;this._dispatchingStarted||(this._dispatchingStarted=true)},onURIChange:function onURIChange(){this.dispatch();this._silent=false},onPopState:function onPopState(t){this._dispatchingStarted&&this.onURIChange()},onClick:function onClick(t){var e=t.target,r=this._matchesSelector(e),i,n;if(1!==t.button&&!t.metaKey&&!t.ctrlKey){while(e){if(this._matchesSelector(e))break;e=e.parentNode}if(e){t.preventDefault();n=this._stripDomain(e.href,window.location.hostname);i=this._removeURIRoot(n);this.navigate(i)}}},getExitMessage:function getExitMessage(){return L(K(this._emitters,(function(t){return t.getExitMessage()}))).join(", ")||void 0},onBeforeUnload:function onBeforeUnload(t){var e=this.getExitMessage();if(e){t.returnValue=e;return e}},navigate:function navigate(t,e){var r;var i=this.getExitMessage();if(!i||window.confirm(i)){e=e||{};this._actions=[];r=this.hrefFor(t,e);e.silent&&(this._silent=true);if(this.pushStateEnabled){r=this._removeURIRoot(r);r=this.root+r;e.replace?history.replaceState("navigate","",r):history.pushState("navigate","",r);this.onURIChange()}else e.replace?location.replace("#"+r):location.hash=r}},hrefFor:function hrefFor(t,e){e=e||{};var r=t+"";var i=this.getCurrentRequest();var n=e.namedParams;var a=e.queryParams;!n&&i&&(n=i.namedParams);a&&(r+=this.serializeQueryParams(a));if(n)for(var o in n)n.hasOwnProperty(o)&&(r=r.replace(":"+o,encodeURIComponent(n[o])));return r},refresh:function refresh(){this.dispatch()},_attachEvents:function _attachEvents(){var t=this.pushStateEnabled;if(t){var e=this;setTimeout((function(){V(window,"popstate",e.onPopState,e)}),0)}else V(window,"hashchange",this.onURIChange,this);V(document,"click",this.onClick,this);V(window,"beforeunload",this.onBeforeUnload,this)},_matchesSelector:function _matchesSelector(t){var e=document.querySelectorAll(this.linkSelector),r=false,i;for(i=0;i<e.length;i++){if(r)break;r=t===e[i]}return r},_invokeExits:function _invokeExits(t){var e,r,i;while(this._exits.length){e=this._exits.pop();r=e.target;i=e.method;if(!(i in r))throw new Error("Can't call exit "+i+" on target when changing uri to "+request.uri);r[i].call(r,t)}},_invokeActions:function _invokeActions(t,e){var r,i,n,a;while(this._actions.length){r=this._actions.shift();i=r.target;n=r.method;a=new j;if(!(n in i))throw new Error("Can't call action "+n+" on target for uri "+t.uri);this._emitters.push(a);i[n].call(i,t,e,a)}},_removeURIRoot:function _removeURIRoot(t){var e=new RegExp("^"+this.root);return t.replace(e,"")},_stripDomain:function _stripDomain(t,e,r){var e=e||window.location.hostname,i=t.indexOf(e)+e.length;var r=r||window.location.port;if(r){var n=e+":"+r;i=t.indexOf(n)+n.length}return t.substr(i)},serializeQueryParams:function serializeQueryParams(t){var e=[],r;for(var i in t)if(t.hasOwnProperty(i)){r=t[i];G(r)?T(r,(function(t){e.push(encodeURIComponent(i)+"[]="+encodeURIComponent(t))})):e.push(encodeURIComponent(i)+"="+encodeURIComponent(r))}e="?"+e.join("&");return e}};M=H;var J=M;var W={};Object.defineProperty(W,"__esModule",{value:true});var X=J;var Y=P;var Z={pushStateEnabled:"pushState"in window.history,linkSelector:"a.navigate",root:"",_navigator:new X,_ActionEmitter:Y,setRoutes:function setRoutes(t){this._navigator.setRoutes(t)},dispatch:function dispatch(){var t=this._navigator;t.setup({pushStateEnabled:this.pushStateEnabled,linkSelector:this.linkSelector,root:this.root});t.dispatch()},navigate:function navigate(t,e){this._navigator.navigate(t,e)},hrefFor:function hrefFor(t,e){return this._navigator.hrefFor(t,e)},serializeQueryParams:function serializeQueryParams(t){return this._navigator.serializeQueryParams(t)},getCurrentRequest:function getCurrentRequest(){return this._navigator.getCurrentRequest()},getCurrentURI:function getCurrentURI(){return this._navigator.getCurrentURI()},refresh:function refresh(){this._navigator.refresh()},rewriteRouteTo:function rewriteRouteTo(t){var e={rewrite:function rewrite(e){Z.navigate(t,{namedParams:e.namedParams,replace:true})}};return{target:e,"/":"rewrite"}}};window&&(window.Aviator=Z);W["default"]=Z;W=W["default"];var $=W;var tt={};var et=$;tt=et;var rt=tt;export default rt;

